<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Game Dev Space</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase v8 -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
*{box-sizing:border-box;font-family:Inter,Arial}
body{
  margin:0;color:#fff;
  background:radial-gradient(circle at top,#1b1f3b,#050510 70%);
}
header{
  padding:20px;text-align:center;
  position:sticky;top:0;
  background:rgba(10,10,25,.7);
  backdrop-filter:blur(10px);
}
header h1{margin:0;font-size:28px}
.actions{position:absolute;right:20px;top:20px;display:flex;gap:10px}
button{
  background:#4f46e5;color:#fff;
  border:none;padding:12px 18px;
  border-radius:14px;font-weight:bold;
  cursor:pointer;transition:.2s
}
button:hover{transform:translateY(-2px)}
main{max-width:1200px;margin:auto;padding:30px}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:20px}
.card{
  background:rgba(20,20,40,.85);
  border-radius:18px;overflow:hidden;
  cursor:pointer;position:relative;
  box-shadow:0 10px 30px rgba(0,0,0,.4);
  transition:.25s
}
.card:hover{transform:translateY(-6px)}
.card img{width:100%;height:140px;object-fit:cover}
.info{padding:14px}
.like-count{
  position:absolute;top:10px;left:10px;
  background:rgba(0,0,0,.6);
  padding:6px 12px;border-radius:999px
}
.delete-btn{
  position:absolute;top:10px;right:10px;
  background:#ef4444;font-size:13px
}
footer{text-align:center;padding:30px;opacity:.4}
#gameView{display:none;max-width:900px;margin:auto;padding:30px}
#gameView img{width:100%;border-radius:18px}
</style>
</head>

<body>

<audio src="https://cdn.pixabay.com/audio/2023/03/28/audio_9b27d4a8e2.mp3" autoplay loop></audio>

<header>
  <h1>Game Dev Space</h1>
  <div class="actions">
    <button id="loginBtn">Login Google</button>
    <button id="postBtn" style="display:none">Postar</button>
    <button id="adminDelBtn" style="display:none;background:#ef4444">Apagar TODOS</button>
    <button id="logoutBtn" style="display:none">Sair</button>
  </div>
</header>

<main id="home">
  <h2>Em alta</h2>
  <div class="grid" id="featured"></div>

  <h2 style="margin-top:40px">Todos os jogos</h2>
  <div class="grid" id="games"></div>
</main>

<div id="gameView"></div>

<footer>Game Dev Space • Biblioteca de jogos</footer>

<script>
/* ================= CONFIG ================= */
const OWNER_UID="EvTgWu6fFFeWJrFdckMNVa1E20J3";

const firebaseConfig={
  apiKey:"AIzaSyAMHAKVot044psR421B_t-Ht5EmsueVS8A",
  authDomain:"game-dev-space.firebaseapp.com",
  databaseURL:"https://game-dev-space-default-rtdb.firebaseio.com",
  projectId:"game-dev-space",
  storageBucket:"game-dev-space.appspot.com",
  messagingSenderId:"1073185335190",
  appId:"1:1073185335190:web:ae9ffd88cdf89f53cbdfb7"
};
firebase.initializeApp(firebaseConfig);

const auth=firebase.auth();
const db=firebase.database();
const gamesRef=db.ref("games");
const usersRef=db.ref("users");

let currentUser=null;
let currentNick="";

/* ================= ELEMENTOS ================= */
const loginBtn=document.getElementById("loginBtn");
const logoutBtn=document.getElementById("logoutBtn");
const postBtn=document.getElementById("postBtn");
const adminDelBtn=document.getElementById("adminDelBtn");
const games=document.getElementById("games");
const featured=document.getElementById("featured");
const home=document.getElementById("home");
const gameView=document.getElementById("gameView");

/* ================= LOGIN ================= */
loginBtn.onclick=()=>{
  const provider=new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider);
};
logoutBtn.onclick=()=>auth.signOut();

/* ================= AUTH STATE ================= */
auth.onAuthStateChanged(u=>{
  currentUser=u;
  if(u){
    loginBtn.style.display="none";
    logoutBtn.style.display="inline-block";
    postBtn.style.display="inline-block";

    usersRef.child(u.uid).once("value",s=>{
      if(s.exists()) currentNick=s.val().nick;
      else{
        currentNick=u.displayName||"Dev";
        usersRef.child(u.uid).set({nick:currentNick});
      }
    });

    if(u.uid===OWNER_UID) adminDelBtn.style.display="inline-block";
  }else{
    loginBtn.style.display="inline-block";
    logoutBtn.style.display="none";
    postBtn.style.display="none";
    adminDelBtn.style.display="none";
  }
});

/* ================= POST ================= */
postBtn.onclick=()=>{
  const name=prompt("Nome do jogo");
  const desc=prompt("Descrição");
  const img=prompt("Imagem (URL)");
  const url=prompt("Link do jogo");
  if(!name||!url)return;

  gamesRef.push({
    name,desc,img,url,
    owner:currentUser.uid,
    ownerNick:currentNick,
    likes:0,likedBy:{},
    views:0,created:Date.now()
  });
};

/* ================= ADMIN ================= */
adminDelBtn.onclick=()=>{
  if(confirm("APAGAR TODOS OS JOGOS?")){
    gamesRef.remove();
  }
};

/* ================= LISTAGEM ================= */
gamesRef.on("value",snap=>{
  games.innerHTML="";
  featured.innerHTML="";
  const data=snap.val();
  if(!data)return;

  const list=Object.entries(data).map(([id,g])=>({...g,id}));

  list.sort((a,b)=>(b.likes+b.views)-(a.likes+a.views))
      .slice(0,4)
      .forEach(g=>featured.appendChild(createCard(g)));

  list.sort((a,b)=>b.created-a.created)
      .forEach(g=>games.appendChild(createCard(g)));
});

/* ================= CARD ================= */
function createCard(g){
  const c=document.createElement("div");
  c.className="card";
  c.innerHTML=`
    <div class="like-count">❤ ${g.likes||0}</div>
    ${(currentUser&&(g.owner===currentUser.uid||currentUser.uid===OWNER_UID))
      ?`<button class="delete-btn">Deletar</button>`:""}
    <img src="${g.img}">
    <div class="info"><h3>${g.name}</h3><small>${g.ownerNick}</small></div>
  `;
  c.onclick=()=>openGame(g);

  const d=c.querySelector(".delete-btn");
  if(d){
    d.onclick=e=>{
      e.stopPropagation();
      if(confirm("Deletar jogo?")) gamesRef.child(g.id).remove();
    };
  }
  return c;
}

/* ================= GAME PAGE ================= */
function openGame(g){
  home.style.display="none";
  gameView.style.display="block";

  gamesRef.child(g.id).child("views")
    .transaction(v=>(v||0)+1);

  gameView.innerHTML=`
    <button onclick="back()">← Voltar</button>
    <img src="${g.img}">
    <h2>${g.name}</h2>
    <p>${g.desc||""}</p>
    <button onclick="window.open('${g.url}')">Jogar</button>
    <button onclick="like('${g.id}')">❤ Curtir</button>
  `;
}
function back(){
  gameView.style.display="none";
  home.style.display="block";
}

/* ================= LIKE ================= */
function like(id){
  if(!currentUser)return alert("Faça login");
  gamesRef.child(id).transaction(g=>{
    if(!g)return g;
    g.likedBy=g.likedBy||{};
    if(g.likedBy[currentUser.uid]){
      delete g.likedBy[currentUser.uid];g.likes--;
    }else{
      g.likedBy[currentUser.uid]=true;g.likes++;
    }
    return g;
  });
}
</script>
</body>
</html>
