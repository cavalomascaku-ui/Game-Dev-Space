<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Game Dev Space V4.1 - FIXED</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;800&family=Inter:wght@300;400;700&display=swap" rel="stylesheet">

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
:root{
--neon:#22c55e;
--glow:rgba(34,197,94,.7);
--bg:#050510;
}
*{box-sizing:border-box;font-family:Inter}
body{margin:0;background:var(--bg);color:#fff}

/* FUNDO HEX NEON */
.hex-bg{
position:fixed;inset:0;z-index:-2;
background:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MiIgaGVpZ2h0PSI2MCI+PHBhdGggZD0iTTI2IDBMNTIgMTVWNDVMMjYgNjBMMCA0NVYxNUwyNiAwWiIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJyZ2JhKDM0LDE5Nyw5NCwuMTUpIi8+PC9zdmc+");
animation:pulse 5s infinite alternate;
}
@keyframes pulse{
0%{filter:drop-shadow(0 0 4px var(--glow))}
100%{filter:drop-shadow(0 0 18px var(--glow))}
}

header{text-align:center;padding:40px 20px}
h1{font-family:Orbitron;color:var(--neon);text-shadow:0 0 20px var(--glow)}

.top-nav{
position:absolute;top:20px;right:20px;display:flex;gap:10px
}
button{cursor:pointer;font-weight:bold;border:none}
.btn{background:var(--neon);color:#000;padding:10px 18px;border-radius:20px}

.user-info{
display:flex;gap:10px;align-items:center;
background:#0008;border:1px solid var(--neon);
padding:5px 15px;border-radius:30px;cursor:pointer
}
.user-info img{width:30px;height:30px;border-radius:50%}

.search-bar{
max-width:500px;margin:20px auto;display:flex;
background:#000;border:1px solid var(--neon);border-radius:30px
}
.search-bar input{
flex:1;background:none;border:none;color:#fff;padding:12px 20px;outline:none
}
.search-bar button{background:var(--neon);padding:0 20px}

.grid{
max-width:1200px;margin:auto;
display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));
gap:25px;padding:20px
}
.card{
background:#0f1025;border:1px solid #ffffff22;
border-radius:12px;overflow:hidden;cursor:pointer;
transition:.3s;position:relative
}
.card:hover{transform:translateY(-6px);box-shadow:0 0 20px var(--glow)}
.card img{width:100%;height:150px;object-fit:cover}
.card-info{text-align:center;padding:10px;font-weight:bold}
.badge{
position:absolute;top:10px;right:10px;
background:#000c;border:1px solid var(--neon);
padding:4px 10px;border-radius:10px
}

/* MODAL */
.modal{
display:none;position:fixed;inset:0;
background:#000c;z-index:999;
align-items:center;justify-content:center
}
.modal-box{
background:#1b2838;padding:25px;
border-radius:8px;width:90%;max-width:400px
}
.modal-box input,textarea{
width:100%;padding:10px;margin:8px 0;
background:#000;color:#fff;border:1px solid #333
}

#gameView{display:none;padding:20px;text-align:center}
iframe{width:100%;height:70vh;border:none;border-radius:10px}
.comment{
display:flex;gap:10px;background:#0006;
padding:10px;margin:10px 0;border-radius:5px
}
.comment img{width:40px;height:40px;border-radius:5px}
</style>
</head>
<body>

<div class="hex-bg"></div>

<header>
<div class="top-nav">
<button class="btn" onclick="adminLogin()">ADMIN</button>
<div id="userTrigger" class="user-info" style="display:none" onclick="openProfile()">
<img id="uPic"><span id="uNick"></span>
</div>
<button id="loginBtn" class="btn" onclick="authModal.style.display='flex'">LOGIN</button>
<button id="outBtn" class="btn" style="display:none;background:red;color:#fff"
onclick="auth.signOut().then(()=>location.reload())">SAIR</button>
</div>

<h1>GAME DEV SPACE</h1>

<div class="search-bar">
<input id="inpSearch" placeholder="Buscar jogo..." oninput="doSearch()">
<button>üîç</button>
</div>
</header>

<div id="authModal" class="modal">
<div class="modal-box">
<h3>LOGIN / REGISTRO</h3>
<input id="email" placeholder="Email">
<input id="pass" type="password" placeholder="Senha">
<button class="btn" style="width:100%" onclick="handleAuth()">ENTRAR</button>
<button onclick="authModal.style.display='none'" style="width:100%;margin-top:10px">FECHAR</button>
</div>
</div>

<div id="profModal" class="modal">
<div class="modal-box">
<h3>MEU PERFIL</h3>
<input id="nickField" placeholder="Nick">
<input id="picField" placeholder="URL da Foto">
<input id="linkField" placeholder="Rede social">
<button class="btn" style="width:100%" onclick="saveProf()">SALVAR</button>
<button onclick="profModal.style.display='none'" style="width:100%;margin-top:10px">VOLTAR</button>
</div>
</div>

<div id="home">
<div class="grid" id="mainGrid"></div>
</div>

<div id="gameView"></div>

<script>
firebase.initializeApp({
apiKey:"AIzaSyAMHAKVot044psR421B_t-Ht5EmsueVS8A",
authDomain:"game-dev-space.firebaseapp.com",
databaseURL:"https://game-dev-space-default-rtdb.firebaseio.com"
});
const auth=firebase.auth(),db=firebase.database();
const ADMIN_PASS="15423993946";

let allGames=[],currentGameId="",isAdmin=false;

/* AUTH */
function handleAuth(){
auth.signInWithEmailAndPassword(email.value,pass.value)
.catch(()=>auth.createUserWithEmailAndPassword(email.value,pass.value))
.then(()=>authModal.style.display="none");
}

auth.onAuthStateChanged(u=>{
loginBtn.style.display=u?"none":"block";
outBtn.style.display=u?"block":"none";
userTrigger.style.display=u?"flex":"none";
if(u){
db.ref("profiles/"+u.uid).on("value",s=>{
const d=s.val()||{};
uNick.innerText=d.nick||"Perfil";
uPic.src=d.pic||"https://www.gravatar.com/avatar/0?d=mp";
});
}
});

/* PERFIL */
function openProfile(){
if(!auth.currentUser)return;
db.ref("profiles/"+auth.currentUser.uid).once("value").then(s=>{
const d=s.val()||{};
nickField.value=d.nick||"";
picField.value=d.pic||"";
linkField.value=d.link||"";
profModal.style.display="flex";
});
}
function saveProf(){
db.ref("profiles/"+auth.currentUser.uid).set({
nick:nickField.value||"Jogador",
pic:picField.value||"",
link:linkField.value||""
}).then(()=>profModal.style.display="none");
}

/* GAMES */
db.ref("games").on("value",s=>{
allGames=[];
s.forEach(c=>allGames.push({id:c.key,...c.val()}));
render(allGames);
});

function render(list){
mainGrid.innerHTML="";
list.sort((a,b)=>(b.likes||0)-(a.likes||0)).forEach(g=>{
const d=document.createElement("div");
d.className="card";
d.innerHTML=`<div class="badge">‚ù§ ${g.likes||0}</div>
<img src="${g.img}">
<div class="card-info">${g.name}</div>`;
d.onclick=()=>openGame(g.id);
mainGrid.appendChild(d);
});
}
function doSearch(){
const t=inpSearch.value.toLowerCase();
render(allGames.filter(g=>g.name.toLowerCase().includes(t)));
}

/* GAME */
function openGame(id){
currentGameId=id;
home.style.display="none";
gameView.style.display="block";
db.ref("games/"+id).once("value").then(s=>{
const g=s.val();
gameView.innerHTML=`
<button class="btn" onclick="back()">VOLTAR</button>
<h2>${g.name}</h2>
<iframe src="${g.url}"></iframe>
<button class="btn" onclick="giveLike()">CURTIR ‚ù§ (${g.likes||0})</button>
<div>
<textarea id="msg" placeholder="Coment√°rio"></textarea>
<button class="btn" onclick="sendCom()">POSTAR</button>
<div id="comList"></div>
</div>`;
loadCom(id);
});
}

function back(){
gameView.style.display="none";
home.style.display="block";
}

/* LIKE */
function giveLike(){
if(!auth.currentUser)return alert("Fa√ßa login");
const uid=auth.currentUser.uid;
db.ref(`likes/${currentGameId}/${uid}`).once("value").then(s=>{
if(s.exists())return alert("J√° curtiu");
db.ref(`likes/${currentGameId}/${uid}`).set(true);
db.ref("games/"+currentGameId+"/likes").transaction(l=>(l||0)+1);
});
}

/* COMMENTS */
function sendCom(){
if(!auth.currentUser||!msg.value)return;
db.ref("profiles/"+auth.currentUser.uid).once("value").then(s=>{
const p=s.val()||{};
db.ref("comments/"+currentGameId).push({
nick:p.nick||"Jogador",
pic:p.pic||"",
text:msg.value
});
msg.value="";
});
}
function loadCom(id){
const r=db.ref("comments/"+id);
r.off();
r.on("value",s=>{
comList.innerHTML="";
s.forEach(c=>{
const d=c.val();
comList.innerHTML=`<div class="comment">
<img src="${d.pic}">
<div><b>${d.nick}</b><p>${d.text}</p></div>
</div>`+comList.innerHTML;
});
});
}

/* ADMIN */
function adminLogin(){
if(prompt("Senha")!==ADMIN_PASS)return;
isAdmin=true;
const n=prompt("Nome"),i=prompt("Capa"),u=prompt("URL");
if(n&&u)db.ref("games").push({name:n,img:i,url:u,likes:0});
}
</script>
</body>
</html>
