<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>Game Dev Space</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- Firebase v8 -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
*{box-sizing:border-box;font-family:Inter,Arial,sans-serif}
body{
  margin:0;
  color:#fff;
  background:radial-gradient(circle at top,#1b1f3b,#050510 70%);
}
header{
  padding:20px;
  text-align:center;
  position:sticky;
  top:0;
  backdrop-filter:blur(10px);
  background:rgba(10,10,25,.7);
  z-index:5;
}
header h1{margin:0;font-size:28px}
header .actions{position:absolute;right:20px;top:20px;display:flex;gap:10px}
button{
  background:#4f46e5;
  color:#fff;
  border:none;
  padding:10px 18px;
  border-radius:14px;
  font-weight:bold;
  cursor:pointer;
}
button.danger{background:#ef4444}
main{max-width:1200px;margin:auto;padding:30px}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:20px}
.card{
  background:rgba(20,20,40,.9);
  border-radius:18px;
  overflow:hidden;
  cursor:pointer;
  box-shadow:0 10px 30px rgba(0,0,0,.4);
  position:relative;
  transition:.2s;
}
.card:hover{transform:translateY(-4px)}
.card img{width:100%;height:140px;object-fit:cover}
.info{padding:14px}
.like-count{
  position:absolute;top:10px;left:10px;
  background:rgba(0,0,0,.6);
  padding:6px 12px;border-radius:999px
}
.delete-btn{
  position:absolute;top:10px;right:10px;
  background:#ef4444;font-size:12px
}
#adminPanel{
  background:rgba(15,15,40,.95);
  padding:20px;border-radius:18px;
  margin-bottom:30px;display:none
}
#gameView{display:none;max-width:900px;margin:auto;padding:30px}
footer{text-align:center;padding:30px;opacity:.4}
</style>
</head>
<body>

<header>
  <h1>Game Dev Space</h1>
  <div class="actions">
    <button id="loginBtn">Login</button>
    <button id="postBtn" style="display:none">Novo Jogo</button>
    <button id="logoutBtn" style="display:none">Sair</button>
  </div>
</header>

<main id="home">
  <section id="adminPanel">
    <h2>Painel Admin</h2>
    <p>Somente você pode ver isso.</p>
    <button class="danger" id="wipeGames">Apagar TODOS os jogos</button>
  </section>

  <h2>Jogos</h2>
  <div class="grid" id="games"></div>
</main>

<main id="gameView"></main>

<footer>Game Dev Space • versão clean</footer>

<script>
/* CONFIG */
const OWNER_UID = "EvTgWu6fFFeWJrFdckMNVa1E20J3";
const firebaseConfig = {
  apiKey: "AIzaSyAMHAKVot044psR421B_t-Ht5EmsueVS8A",
  authDomain: "game-dev-space.firebaseapp.com",
  databaseURL: "https://game-dev-space-default-rtdb.firebaseio.com",
  projectId: "game-dev-space",
};
firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.database();
const gamesRef = db.ref("games");

let currentUser = null;

/* AUTH */
auth.onAuthStateChanged(user=>{
  currentUser=user;
  loginBtn.style.display=user?"none":"inline-block";
  logoutBtn.style.display=user?"inline-block":"none";
  postBtn.style.display=user?"inline-block":"none";
  adminPanel.style.display=(user&&user.uid===OWNER_UID)?"block":"none";
});
loginBtn.onclick=()=>auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
logoutBtn.onclick=()=>auth.signOut();

/* POST */
postBtn.onclick=()=>{
  if(!currentUser) return;
  const name=prompt("Nome do jogo");
  const img=prompt("Imagem (URL)");
  const url=prompt("Link do jogo");
  if(!name||!url) return;
  gamesRef.push({
    name,img:img||"",url,
    likes:0,likedBy:{},
    owner:currentUser.uid,
    created:Date.now()
  });
};

wipeGames.onclick=()=>{
  if(confirm("APAGAR TODOS OS JOGOS?")) gamesRef.remove();
};

/* RENDER */
const gamesEl=document.getElementById("games");

gamesRef.on("value",snap=>{
  gamesEl.innerHTML="";
  const data=snap.val()||{};
  Object.entries(data)
    .sort((a,b)=>b[1].likes-a[1].likes)
    .forEach(([id,g])=>gamesEl.appendChild(card(id,g)));
});

function card(id,g){
  const d=document.createElement("div");
  d.className="card";
  const canDel=currentUser&&(currentUser.uid===OWNER_UID||currentUser.uid===g.owner);
  d.innerHTML=`
    <div class="like-count">❤ ${g.likes||0}</div>
    ${canDel?`<button class="delete-btn">X</button>`:""}
    <img src="${g.img}">
    <div class="info"><h3>${g.name}</h3></div>`;
  d.onclick=()=>openGame(id,g);
  if(canDel){
    d.querySelector(".delete-btn").onclick=e=>{
      e.stopPropagation();
      if(confirm("Deletar jogo?")) gamesRef.child(id).remove();
    };
  }
  return d;
}

/* GAME VIEW */
function openGame(id,g){
  home.style.display="none";
  gameView.style.display="block";
  gameView.innerHTML=`
    <button onclick="back()">← Voltar</button>
    <h2>${g.name}</h2>
    <button onclick="like('${id}')">❤ Curtir</button>
    <button onclick="window.open('${g.url}')">Jogar</button>`;
}
function back(){
  gameView.style.display="none";
  home.style.display="block";
}

/* LIKE FIX */
function like(id){
  if(!currentUser) return alert("Faça login");
  gamesRef.child(id).transaction(g=>{
    if(!g) return g;
    g.likedBy=g.likedBy||{};
    if(g.likedBy[currentUser.uid]) return g;
    g.likedBy[currentUser.uid]=true;
    g.likes=(g.likes||0)+1;
    return g;
  });
}
</script>
</body>
</html>
