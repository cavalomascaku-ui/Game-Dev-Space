<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>GAMEHUB | Cloud</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
<script src="https://unpkg.com/lucide@latest"></script>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<style>
body{margin:0;font-family:Inter;background:#070b14;color:#fff}
header{display:flex;gap:20px;align-items:center;padding:15px 30px;background:#020617;position:sticky;top:0;z-index:10}
h1{color:#8b5cf6;margin:0}
input,textarea{width:100%;padding:10px;background:#020617;border:1px solid #1e293b;color:white;border-radius:6px}
button{cursor:pointer}
.btn{background:#8b5cf6;color:white;border:none;padding:10px 16px;border-radius:6px;font-weight:700}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:20px;padding:30px}
.card{background:#020617;border:1px solid #1e293b;border-radius:12px;overflow:hidden;cursor:pointer}
.card img{width:100%;height:150px;object-fit:cover}
.card div{padding:10px;font-weight:700}
#gamePage{position:fixed;inset:0;background:#020617;display:none;flex-direction:column;z-index:100}
#gameIframe{width:100%;height:100%;border:none}
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.8);z-index:200}
.modal-box{background:#020617;padding:20px;border-radius:12px;width:90%;max-width:400px}
</style>
</head>

<body>

<header>
<h1>GAMEHUB</h1>
<button class="btn" onclick="openPost()">POSTAR</button>
<button class="btn" onclick="openAuth()">LOGIN</button>
</header>

<div class="grid" id="games"></div>

<!-- GAME -->
<div id="gamePage">
<button class="btn" onclick="closeGame()">FECHAR</button>
<iframe id="gameIframe"
 sandbox="allow-scripts allow-pointer-lock allow-fullscreen">
</iframe>
</div>

<!-- MODAL AUTH -->
<div class="modal" id="authModal">
<div class="modal-box">
<h3>LOGIN</h3>
<input id="email" placeholder="Email">
<input id="nick" placeholder="Nick">
<button class="btn" onclick="login()">ENTRAR</button>
</div>
</div>

<!-- MODAL POST -->
<div class="modal" id="postModal">
<div class="modal-box">
<h3>NOVO JOGO</h3>
<input id="title" placeholder="Título">
<input id="pic" placeholder="URL da capa">
<textarea id="desc" placeholder="Descrição"></textarea>

<select id="type">
<option value="link">Link</option>
<option value="upload">Upload HTML</option>
</select>

<input id="url" placeholder="Link do jogo">
<input type="file" id="file" accept=".html">

<button class="btn" onclick="post()">PUBLICAR</button>
</div>
</div>

<script>
const firebaseConfig = {
 apiKey: "AIzaSyAMHAKVot044psR421B_t-Ht5EmsueVS8A",
 authDomain: "game-dev-space.firebaseapp.com",
 projectId: "game-dev-space"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const ADMIN_UID = "SEU_UID_AQUI";
const MAX_POSTS = 5;

let user = JSON.parse(localStorage.getItem("user")) || null;

function esc(s=""){return s.replace(/[&<>"']/g,m=>({ "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m]))}

db.collection("games").orderBy("createdAt","desc")
.onSnapshot(s=>{
 let g=document.getElementById("games");
 g.innerHTML="";
 s.forEach(d=>{
  let x=d.data();
  g.innerHTML+=`
   <div class="card" onclick="openGame('${d.id}')">
    <img src="${x.pic}">
    <div>${esc(x.title)}</div>
   </div>`;
 });
});

async function openGame(id){
 const g=(await db.collection("games").doc(id).get()).data();
 const iframe=document.getElementById("gameIframe");
 iframe.src="";
 iframe.srcdoc="";
 if(g.url.startsWith("data:text/html")){
   iframe.srcdoc=atob(g.url.split(",")[1]);
 }else{
   iframe.src=g.url;
 }
 document.getElementById("gamePage").style.display="flex";
}

function closeGame(){
 document.getElementById("gamePage").style.display="none";
 document.getElementById("gameIframe").src="";
 document.getElementById("gameIframe").srcdoc="";
}

function openAuth(){document.getElementById("authModal").style.display="flex"}
function openPost(){document.getElementById("postModal").style.display="flex"}

function login(){
 user={email:email.value,nick:nick.value};
 localStorage.setItem("user",JSON.stringify(user));
 location.reload();
}

function toBase64(f){return new Promise(r=>{let rd=new FileReader();rd.onload=e=>r(e.target.result);rd.readAsDataURL(f)})}

async function post(){
 if(!user) return alert("LOGIN");
 const count=await db.collection("games").where("author","==",user.email).get();
 if(count.size>=MAX_POSTS) return alert("LIMITE ATINGIDO");

 let finalUrl="";
 if(type.value==="link"){
  finalUrl=url.value;
  if(!finalUrl) return alert("LINK");
 }else{
  if(!file.files[0]) return alert("HTML");
  if(file.files[0].size>800*1024) return alert("MAX 800KB");
  finalUrl=await toBase64(file.files[0]);
 }

 await db.collection("games").add({
  title:esc(title.value),
  pic:pic.value,
  desc:esc(desc.value),
  url:finalUrl,
  author:user.email,
  createdAt:firebase.firestore.FieldValue.serverTimestamp()
 });

 location.reload();
}
lucide.createIcons();
</script>

</body>
</html>
